<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Processing Submission</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("YOUR_USER_ID"); // Replace with your EmailJS user ID
    })();

    window.onload = function() {
      // Get teacher info & scores from localStorage
      let teacherInfo = JSON.parse(localStorage.getItem("teacherInfo"));
      let scores = JSON.parse(localStorage.getItem("scores"));

      if (!teacherInfo || !scores) {
        document.getElementById("status").innerText = 
          "No submission data found. Please restart.";
        return;
      }

      // Prepare the email content
      let emailData = {
        name: teacherInfo.name,
        email: teacherInfo.email,
        phone: teacherInfo.phone,
        subject: teacherInfo.subject,
        scoreMath: scores.math,
        scorePhysics: scores.physics,
        scoreChemistry: scores.chemistry,
        scoreBiology: scores.biology,
        total: scores.total
      };

      // Send email via EmailJS
      emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", emailData)
        .then(function(response) {
          document.getElementById("status").innerText = 
            "✅ You have successfully completed the registration and exam. Your results have been submitted.";
          // Clear storage to prevent resubmission
          localStorage.clear();
          history.pushState(null, null, window.location.href);
          window.onpopstate = function () {
            history.go(1);
          };
        }, function(error) {
          document.getElementById("status").innerText = 
            "❌ Failed to submit. Please contact admin.";
        });
    };
  </script>
</head>
<body>
  <h2 id="status">Submitting your results, please wait...</h2>
</body>
</html>
